<section editableGroup (editableModeChange)="handleModeChange($event)" (save)="updateGroupedEdition()"
    (cancel)="cancelGroupedEdition()">
    <div class="flex flex-col sm:flex-row items-start justify-between">
        <div class="text-lg font-medium tracking-tight leading-6 truncate">
            Proposal Information
        </div>
        <!-- Buttons -->
        <div class="mt-3 sm:mt-0 sm:ml-2">
            <button mat-raised-button *ngIf="mode === 'view'" data-testid="groupedForm-edit-btn" editableGroupEdit>
                Edit
            </button>
            <button mat-raised-button *ngIf="mode === 'edit' && groupedForm.valid" data-testid="groupedForm-save-btn"
                editableGroupSave>
                Save
            </button>
            <button mat-raised-button *ngIf="mode === 'edit'" data-testid="groupedForm-cancel-btn" editableGroupCancel>
                Cancel
            </button>
        </div>
    </div>
    <div class="flex flex-col mt-2">
        <div *ngIf="editing">
            <form *ngIf="proposal" [formGroup]="groupedForm" class="w-full">
                <div class="flex flex-wrap -mx-3 mb-6">
                    <div class="w-full px-3">
                        <label class="block tracking-wide text-sm mb-2" for="grid-project-title">
                            Project Title
                        </label>
                        <mat-form-field style="width: 100%">
                            <input matInput placeholder="Project Title" formControlName="projectTitle"
                                value="{{ projectTitle }}" maxlength="100" required (keyup)="
                                    projectTitle$.next($event.target.value)
                                " />
                            <mat-error *ngIf="
                                    groupedForm
                                        .get('projectTitle')
                                        .hasError('required')
                                ">
                                Project Title is
                                <strong>required</strong>
                            </mat-error>
                        </mat-form-field>
                    </div>
                </div>
                <div class="flex flex-wrap -mx-3 mb-6">
                    <div class="w-full px-3">
                        <label class="block tracking-wide text-sm mb-2" for="grid-purpose">
                            Describe the purpose of your project:
                        </label>
                        <mat-form-field class="purpose">
                            <textarea class="resize-none" matInput placeholder="Purpose" formControlName="purpose"
                                matTextareaAutosize rows="5" matAutosizeMinRows="5" matAutosizeMaxRows="5"
                                maxLength="500" value="{{ purpose }}" required
                                (keyup)="purpose$.next($event.target.value)"></textarea>
                            <mat-hint align="end">{{ purpose.length }} / 500</mat-hint>
                            <mat-error *ngIf="
                                    groupedForm
                                        .get('purpose')
                                        .hasError('required')
                                ">
                                Purpose is
                                <strong>required</strong>
                            </mat-error>
                        </mat-form-field>
                    </div>
                </div>
                <div class="flex flex-wrap -mx-3 mb-6">
                    <div class="w-full px-3">
                        <label class="block tracking-wide text-sm mb-2" for="grid-goals">
                            Describe the specific goals and/or intended
                            outcomes of your project:
                        </label>
                        <mat-form-field class="goals">
                            <textarea class="resize-none" matInput formControlName="goals" placeholder="Goals"
                                matTextareaAutosize rows="5" matAutosizeMinRows="5" matAutosizeMaxRows="5"
                                maxLength="500" value="{{ goals }}" required
                                (keyup)="goals$.next($event.target.value)"></textarea>
                            <mat-hint align="end">{{ goals.length }} / 500</mat-hint>
                            <mat-error *ngIf="
                                    groupedForm
                                        .get('goals')
                                        .hasError('required')
                                ">
                                Goals is
                                <strong>required</strong>
                            </mat-error>
                        </mat-form-field>
                    </div>
                </div>
                <div class="flex flex-wrap -mx-3 mb-6">
                    <div class="w-full px-3">
                        <label class="block tracking-wide text-sm mb-2" for="grid-narrative">
                            Provide a detailed project narrative that addresses the following questions, if
                            relevant.
                            Is this a new activity? How does the project fit into your organization's mission?
                            Who will be responsible for overseeing the project? How will you evaluate the
                            success? Do you anticipate partnering with any other organizations?
                        </label>
                        <mat-form-field>
                            <textarea class="resize-none" matInput formControlName="narrative" value="{{ narrative }}"
                                type="text" id="narrative" matTextareaAutosize rows="5" matAutosizeMinRows="5"
                                matAutosizeMaxRows="5" maxlength="2000" placeholder="Narrative"
                                (keyup)="phone$.next($event.target.value)" required></textarea>
                            <mat-hint align="end">{{ narrative.length }} /2000</mat-hint>
                            <mat-error *ngIf="
                                    groupedForm
                                        .get('narrative')
                                        .hasError('required')
                                ">
                                Narrative is
                                <strong>required</strong>
                            </mat-error>
                        </mat-form-field>
                    </div>
                </div>
                <div class="flex flex-wrap -mx-3 mb-6">
                    <div class="w-full px-3">
                        <label class="block tracking-wide text-sm mb-2" for="grid-time-table">
                            Provide a timeline for your project with key milestones.
                        </label>
                        <mat-form-field>
                            <textarea class="resize-none" matInput placeholder="Time Table" formControlName="timeTable"
                                matTextareaAutosize rows="5" matAutosizeMinRows="5" matAutosizeMaxRows="5"
                                maxLength="500" value="{{ timeTable }}" (keyup)="timeTable$.next($event.target.value)"
                                required></textarea>
                            <mat-hint align="end">{{ timeTable.length }} / 500</mat-hint>
                            <mat-error *ngIf="
                                    groupedForm
                                        .get('timeTable')
                                        .hasError('required')
                                ">
                                Time Table is
                                <strong>required</strong>
                            </mat-error>
                        </mat-form-field>
                    </div>
                </div>
                <div class="flex flex-wrap -mx-3 mb-6">
                    <div class="w-full px-3">
                        <label class="block tracking-wide text-sm mb-2" for="grid-contact-person-title">
                            Amount Requested
                        </label>
                        <mat-form-field>
                            <input matInput placeholder="Amount Requested" formControlName="amountRequested"
                                maxlength="10" value="{{ amountRequested }}" (keyup)="
                                    amountedRequested$.next($event.target.value)
                                " required />
                            <mat-error *ngIf="
                                    groupedForm
                                        .get('amountRequested')
                                        .hasError('required')
                                ">
                                Amount Requested is
                                <strong>required</strong>
                            </mat-error>
                        </mat-form-field>
                    </div>
                </div>
                <div class="flex flex-wrap -mx-3 mb-6">
                    <div class="w-full px-3">
                        <label class="block tracking-wide text-sm mb-2" for="grid-itemized-budget">
                            Explain how the budget will be allocated
                            across different expense items (e.g.,
                            materials, labor).
                        </label>
                        <mat-form-field>
                            <textarea class="resize-none" matInput value="{{ itemizedBudget }}" type="text"
                                matTextareaAutosize rows="5" matAutosizeMinRows="5" matAutosizeMaxRows="5"
                                maxLength="500" formControlName="itemizedBudget" id="itemized-budget"
                                placeholder="Itemized Budget" (keyup)="
                                    itemizedBudget$.next($event.target.value)
                                " required></textarea>
                            <mat-hint align="end">{{ itemizedBudget.length }} / 500</mat-hint>
                            <mat-error *ngIf="
                                    groupedForm
                                        .get('itemizedBudget')
                                        .hasError('required')
                                ">
                                Itemized Budget is
                                <strong>required</strong>
                            </mat-error>
                        </mat-form-field>
                    </div>
                </div>
                <div class="flex flex-wrap -mx-3 mb-6">
                    <div class="w-full px-3">
                        <label class="block tracking-wide text-sm mb-2" for="grid-total-project-cost">
                            Total Project Cost
                        </label>
                        <mat-form-field>
                            <input matInput class="form-control" value="{{ totalProjectCost }}" type="text"
                                maxlength="10" formControlName="totalProjectCost" id="total-project-cost"
                                placeholder="Total Project Cost" (keyup)="
                                    totalProjectCost$.next($event.target.value)
                                " required />
                            <mat-error *ngIf="
                                    groupedForm
                                        .get('totalProjectCost')
                                        .hasError('required')
                                ">
                                Total Project Cost is
                                <strong>required</strong>
                            </mat-error>
                        </mat-form-field>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div *ngIf="editing">
        <div class="flex flex-col sm:flex-row items-start justify-between">
            <div class="text-lg font-medium tracking-tight leading-6 truncate">
                <!-- Proposal Information -->
            </div>
            <!-- Buttons -->
            <div class="mt-3 sm:mt-0 sm:ml-2">
                <button mat-raised-button *ngIf="mode === 'view'" data-testid="groupedForm-edit-btn" editableGroupEdit>
                    Edit
                </button>
                <button mat-raised-button *ngIf="mode === 'edit' && groupedForm.valid"
                    data-testid="groupedForm-save-btn" editableGroupSave>
                    Save
                </button>
                <button mat-raised-button *ngIf="mode === 'edit'" data-testid="groupedForm-cancel-btn"
                    editableGroupCancel>
                    Cancel
                </button>
            </div>
        </div>
    </div>
</section>

<section>
    <article>
        <div *ngIf="!editing">
            <form *ngIf="proposal" [formGroup]="groupedForm" class="w-full">
                <div class="flex flex-wrap -mx-3 mb-6">
                    <div class="w-full px-3">
                        <label class="block tracking-wide text-sm mb-2" for="grid-project-title">
                            Project Title
                        </label>
                        <editable data-testid="sample-input-click" (save)="
                                updateSingleField(
                                    'projectTitle',
                                    'projectTitleControl'
                                )
                            " (cancel)="
                                cancelSingleField(
                                    'projectTitleName',
                                    'projectTitleControl'
                                )
                            ">
                            <ng-template viewMode>
                                <div class="appearance-none block w-full text-gray-700 border border-white rounded py-3 px-4 mb-3 leading-tight hover:border-gray-500 hover:bg-slate-200 {{
                                        invalidInputProjectTitle
                                            ? 'border-red-600'
                                            : ''
                                    }}">
                                    {{ propObj.projectTitle }}
                                </div>
                            </ng-template>
                            <ng-template editMode>
                                <div
                                    class="appearance-none block w-full text-gray-700 border rounded py-3 px-4 mb-3 focus:outline focus:bg-white focus:border-gray-500">
                                    <input class="form-control" editableFocusable data-testid="sample-input-click-edit"
                                        maxLength="100" placeholder="Project Title" type="text"
                                        [formControl]="projectTitleControl" />
                                    <!-- <textarea
                                        class="resize-none"
                                        editableFocusable
                                        matInput
                                        placeholder="Project Title"
                                        [formControl]="projectTitleControl"
                                        required
                                    ></textarea> -->
                                </div>
                            </ng-template>
                        </editable>
                        <mat-error *ngIf="invalidInputProjectTitle">
                            Project Title is
                            <strong>required</strong>
                        </mat-error>
                    </div>
                </div>
                <div class="flex flex-wrap -mx-3 mb-6">
                    <div class="w-full px-3">
                        <label class="block tracking-wide text-sm mb-2" for="grid-purpose">
                            Describe the purpose of your project:
                        </label>
                        <editable data-testid="sample-input-click" (save)="
                                updateSingleField('purpose', 'purposeControl')
                            " (cancel)="
                                cancelSingleField('purpose', 'purposeControl')
                            ">
                            <ng-template viewMode>
                                <div class="appearance-none block w-full text-gray-700 border border-white rounded py-3 px-4 mb-3 leading-tight hover:border-gray-500 hover:bg-slate-200 {{
                                        invalidInputPurpose
                                            ? 'border-red-600'
                                            : ''
                                    }}">
                                    {{ propObj.purpose }}
                                </div>
                            </ng-template>
                            <ng-template editMode>
                                <div
                                    class="appearance-none block w-full text-gray-700 border rounded py-3 px-4 mb-3 focus:outline focus:bg-white focus:border-gray-500">
                                    <textarea class="resize-none" editableFocusable matInput matTextareaAutosize
                                        rows="5" matAutosizeMinRows="5" matAutosizeMaxRows="5" maxLength="500"
                                        placeholder="Purpose" [formControl]="purposeControl" required></textarea>
                                </div>
                            </ng-template>
                        </editable>
                        <mat-hint align="end">{{ purpose?.toString().length }} / 500</mat-hint>
                        <mat-error *ngIf="invalidInputPurpose">
                            Purpose is
                            <strong>required</strong>
                        </mat-error>
                    </div>
                </div>
                <div class="flex flex-wrap -mx-3 mb-6">
                    <div class="w-full px-3">
                        <label class="block tracking-wide text-sm mb-2" for="grid-goals">
                            Describe the specific goals and/or intended
                            outcomes of your project:
                        </label>
                        <editable data-testid="sample-input-click" (save)="updateSingleField('goals', 'goalsControl')"
                            (cancel)="
                                cancelSingleField('goals', 'goalsControl')
                            ">
                            <ng-template viewMode>
                                <div class="appearance-none block w-full text-gray-700 border border-white rounded py-3 px-4 mb-3 leading-tight hover:border-gray-500 hover:bg-slate-200 {{
                                        invalidInputGoals
                                            ? 'border-red-600'
                                            : ''
                                    }}">
                                    {{ propObj.goals }}
                                </div>
                            </ng-template>
                            <ng-template editMode>
                                <div
                                    class="appearance-none block w-full text-gray-700 border rounded py-3 px-4 mb-3 focus:outline focus:bg-white focus:border-gray-500">
                                    <textarea class="resize-none" editableFocusable matInput matTextareaAutosize
                                        rows="5" matAutosizeMinRows="5" matAutosizeMaxRows="5" maxLength="500"
                                        placeholder="Goals" [formControl]="goalsControl" required></textarea>
                                </div>
                            </ng-template>
                        </editable>
                        <mat-hint align="end">{{ goals?.toString().length }} / 500</mat-hint>
                        <mat-error *ngIf="invalidInputGoals">
                            Goals is
                            <strong>required</strong>
                        </mat-error>
                    </div>
                </div>
                <div class="flex flex-wrap -mx-3 mb-6">
                    <div class="w-full px-3">
                        <label class="block tracking-wide text-sm mb-2" for="grid-narrative">
                            Provide a detailed project narrative that addresses the following questions, if
                            relevant.
                            Is this a new activity? How does the project fit into your organization's mission?
                            Who will be responsible for overseeing the project? How will you evaluate the
                            success? Do you anticipate partnering with any other organizations?
                        </label>
                        <editable data-testid="sample-input-click" (save)="
                                updateSingleField(
                                    'narrative',
                                    'narrativeControl'
                                )
                            " (cancel)="
                                cancelSingleField(
                                    'narrative',
                                    'narrativeControl'
                                )
                            ">
                            <ng-template viewMode>
                                <div class="appearance-none block w-full text-gray-700 border border-white rounded py-3 px-4 mb-3 leading-tight hover:border-gray-500 hover:bg-slate-200 {{
                                        invalidInputNarrative
                                            ? 'border-red-600'
                                            : ''
                                    }}">
                                    {{ propObj.narrative }}
                                </div>
                            </ng-template>
                            <ng-template editMode>
                                <div
                                    class="appearance-none block w-full text-gray-700 border rounded py-3 px-4 mb-3 focus:outline focus:bg-white focus:border-gray-500">
                                    <textarea class="resize-none" editableFocusable matInput matTextareaAutosize
                                        rows="5" matAutosizeMinRows="5" matAutosizeMaxRows="5" maxLength="2000"
                                        placeholder="Narrative" [formControl]="narrativeControl" required></textarea>
                                </div>
                            </ng-template>
                        </editable>
                        <mat-hint align="end">{{ narrative?.toString().length }} / 2000</mat-hint>
                        <mat-error *ngIf="invalidInputNarrative">
                            Narrative is
                            <strong>required</strong>
                        </mat-error>
                    </div>
                </div>
                <div class="flex flex-wrap -mx-3 mb-6">
                    <div class="w-full px-3">
                        <label class="block tracking-wide text-sm mb-2" for="grid-time-table">
                            Provide a timeline for your project with key milestones.
                        </label>
                        <editable data-testid="sample-input-click" (save)="
                                updateSingleField(
                                    'timeTable',
                                    'timeTableControl'
                                )
                            " (cancel)="
                                cancelSingleField(
                                    'timeTable',
                                    'timeTableControl'
                                )
                            ">
                            <ng-template viewMode>
                                <div class="appearance-none block w-full text-gray-700 border border-white rounded py-3 px-4 mb-3 leading-tight hover:border-gray-500 hover:bg-slate-200 {{
                                        invalidInputTimeTable
                                            ? 'border-red-600'
                                            : ''
                                    }}">
                                    {{ propObj.timeTable }}
                                </div>
                            </ng-template>
                            <ng-template editMode>
                                <div
                                    class="appearance-none block w-full text-gray-700 border rounded py-3 px-4 mb-3 focus:outline focus:bg-white focus:border-gray-500">
                                    <textarea class="resize-none" editableFocusable matInput matTextareaAutosize
                                        rows="5" matAutosizeMinRows="5" matAutosizeMaxRows="5" maxLength="500"
                                        placeholder="Time Table" [formControl]="timeTableControl" required></textarea>
                                </div>
                            </ng-template>
                        </editable>
                        <mat-hint align="end">{{ timeTable?.toString().length }} / 500</mat-hint>
                        <mat-error *ngIf="invalidInputTimeTable">
                            Timeline is
                            <strong>required</strong>
                        </mat-error>
                    </div>
                </div>
                <div class="flex flex-wrap -mx-3 mb-6">
                    <div class="w-full px-3">
                        <label class="block tracking-wide text-sm mb-2" for="grid-amount-requested">
                            Amount Requested
                        </label>
                        <editable data-testid="sample-input-click" (save)="
                                updateSingleField(
                                    'amountedRequested',
                                    'amountRequestedControl'
                                )
                            " (cancel)="
                                cancelSingleField(
                                    'amountedRequested',
                                    'amountRequestedControl'
                                )
                            ">
                            <ng-template viewMode>
                                <div class="appearance-none block w-full text-gray-700 border border-white rounded py-3 px-4 mb-3 leading-tight hover:border-gray-500 hover:bg-slate-200 {{
                                        invalidInputAmountRequested
                                            ? 'border-red-600'
                                            : ''
                                    }}">
                                    {{ propObj.amountRequested | currency }}
                                </div>
                            </ng-template>
                            <ng-template editMode>
                                <div
                                    class="appearance-none block w-full text-gray-700 border rounded py-3 px-4 mb-3 focus:outline focus:bg-white focus:border-gray-500">
                                    <input class="form-control" editableFocusable currencyMask maxLength="10"
                                        data-testid="sample-input-click-edit" placeholder="Amount Requested" type="text"
                                        [formControl]="amountRequestedControl" />
                                </div>
                            </ng-template>
                        </editable>
                        <mat-error *ngIf="invalidInputAmountRequested">
                            Amount Requested is
                            <strong>required</strong>
                        </mat-error>
                    </div>
                </div>
                <div class="flex flex-wrap -mx-3 mb-6">
                    <div class="w-full px-3">
                        <label class="block tracking-wide text-sm mb-2" for="grid-itemized-budget">
                            Explain how the budget will be allocated
                            across different expense items (e.g.,
                            materials, labor).
                        </label>
                        <editable data-testid="sample-input-click" (save)="
                                updateSingleField(
                                    'itemizedBudget',
                                    'itemizedBudgetControl'
                                )
                            " (cancel)="
                                cancelSingleField(
                                    'itemizedBudget',
                                    'itemizedBudgetControl'
                                )
                            ">
                            <ng-template viewMode>
                                <div class="appearance-none block w-full text-gray-700 border border-white rounded py-3 px-4 mb-3 leading-tight hover:border-gray-500 hover:bg-slate-200 {{
                                        invalidInputItemizedBudget
                                            ? 'border-red-600'
                                            : ''
                                    }}">
                                    {{ propObj.itemizedBudget }}
                                </div>
                            </ng-template>
                            <ng-template editMode>
                                <div
                                    class="appearance-none block w-full text-gray-700 border rounded py-3 px-4 mb-3 focus:outline focus:bg-white focus:border-gray-500">
                                    <textarea class="resize-none" editableFocusable matInput matTextareaAutosize
                                        rows="5" matAutosizeMinRows="5" matAutosizeMaxRows="5" maxLength="500"
                                        placeholder="Itemized Budget" [formControl]="itemizedBudgetControl"
                                        required></textarea>
                                </div>
                            </ng-template>
                        </editable>
                        <mat-hint align="end">{{ itemizedBudget?.toString().length }} /
                            500</mat-hint>
                        <mat-error *ngIf="invalidItemizedBudget">
                            Itemized Budget is
                            <strong>required</strong>
                        </mat-error>
                    </div>
                </div>
                <div class="flex flex-wrap -mx-3 mb-6">
                    <div class="w-full px-3">
                        <label class="block tracking-wide text-sm mb-2" for="grid-total-project-cost">
                            Total Project Cost
                        </label>
                        <editable data-testid="sample-input-click" (save)="
                                updateSingleField(
                                    'totalProjectCost',
                                    'totalProjectCostControl'
                                )
                            " (cancel)="
                                cancelSingleField(
                                    'totalProjectCost',
                                    'totalProjectCostControl'
                                )
                            ">
                            <ng-template viewMode>
                                <div class="appearance-none block w-full text-gray-700 border border-white rounded py-3 px-4 mb-3 leading-tight hover:border-gray-500 hover:bg-slate-200 {{
                                        invalidInputTotalProjectCost
                                            ? 'border-red-600'
                                            : ''
                                    }}">
                                    {{ propObj.totalProjectCost | currency }}
                                </div>
                            </ng-template>
                            <ng-template editMode>
                                <div
                                    class="appearance-none block w-full text-gray-700 border rounded py-3 px-4 mb-3 focus:outline focus:bg-white focus:border-gray-500">
                                    <input class="form-control" editableFocusable currencyMask maxLength="10"
                                        data-testid="sample-input-click-edit" placeholder="Total Project Cost"
                                        type="text" [formControl]="totalProjectCostControl" />
                                </div>
                            </ng-template>
                        </editable>
                        <mat-error *ngIf="invalidInputTotalProjectCost">
                            Total Project Cost is
                            <strong>required</strong>
                        </mat-error>
                    </div>
                </div>
            </form>
        </div>
    </article>
</section>